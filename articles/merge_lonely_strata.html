<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Merge lonely strata • struktuR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Merge lonely strata">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">struktuR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/FillStrata.html">FillStrata</a></li>
    <li><a class="dropdown-item" href="../articles/merge_lonely_strata.html">Merge lonely strata</a></li>
    <li><a class="dropdown-item" href="../articles/struktur-vignette.html">Estimation using struktuR</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="merge_lonely_strata_files/kePrint-0.0.1/kePrint.js"></script><link href="merge_lonely_strata_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Merge lonely strata</h1>
                        <h4 data-toc-skip class="author">Melike Oguz
Alper</h4>
            
            <h4 data-toc-skip class="date">10.09.2025</h4>
      

      <div class="d-none name"><code>merge_lonely_strata.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>The <code>merge_lonely_strata</code> is one of the R functions in the
<code>struktuR</code> R package, which is documented <a href="https://statisticsnorway.github.io/ssb-struktur/articles/struktur-vignette.html" class="external-link">here</a>
(English). Lonely strata are defined to be non take-all strata with only
one observation in sample data. Variance estimation would not be
possible within such strata, which is a common problem, particularly in
business surveys, where many strata, some of which may be quite small,
are often used.</p>
<p>The main purpose of this function is to:</p>
<ul>
<li>Create estimation strata (or artificial <em>superstrata</em>) by
merging lonely strata.</li>
</ul>
<p>This function uses the <code>collapse.strata</code> function from the
<code>ReGenesees</code> package. The idea is to merge lonely strata by
using population means of an auxiliary variable, denoted by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>,
as a similarity measure. A lonely stratum is merged to another lonely
stratum or a larger stratum which is the most similar to that lonely
stratum in terms of the population mean of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>-variable.
If strata with only one observation are take-all strata, then these
strata are ignored in strata merging since corresponding variances are
set to zero for such strata in the <code>struktuR</code> as well as in
the Python version <a href="https://statisticsnorway.github.io/ssb-statstruk/guide_ratio.html" class="external-link">Statstruk</a>,
and SAS-application Struktur (<a href="https://www.ssb.no/a/publikasjoner/pdf/notat_200730/notat_200730.pdf" class="external-link">Using
SAS-Struktur</a>, Norsk).</p>
<p>This function should only be used for sample surveys with
(stratified) single-stage sampling design where simple random sampling
is used within each stratum to select sampling units.</p>
<p>Strata merge may not always be successful due to the reasons
described in the following section of this document.</p>
</div>
<div class="section level3">
<h3 id="package-installation">Package installation<a class="anchor" aria-label="anchor" href="#package-installation"></a>
</h3>
<p>For internal Statistic Norway users, the package is already installed
on many of the production servers and this step may be skipped. For
other users the package can be installed from github using the
<code>devtools</code> function <code>install_github</code>. This step
only needs to be run one time.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"statisticsnorway/ssb-struktur"</span><span class="op">)</span></span></code></pre></div>
<p>To access and use the functions in the package we need to run
<code>library</code> each time we start a new R session.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">struktuR</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-requirements">Data requirements<a class="anchor" aria-label="anchor" href="#data-requirements"></a>
</h3>
<p>We need data on both the <em>sample</em> and <em>population</em>. The
following variables should be included:</p>
<p><strong>Population data set</strong>:</p>
<ul>
<li>ID variable (<code>id</code>) which is consistent in both the
population and sample data sets.</li>
<li>An explanatory variable when using regression and rate models
(<code>x</code>). This is a variable which the statistic variable is
correlated with.</li>
<li>A strata variable (<code>strata</code>) which divides the population
into groups which are similar to each other. This is the smallest
grouping variable and which separate models will be run on.</li>
<li>Domain variables (or publication groups: <code>group</code>) for
producing statistical totals for. These should be able to be created by
joining strata groups together.</li>
<li>Blocking variables (<code>block</code>) that are used to constrain
strata merge, in a way that estimation strata can only be created within
blocks. This parameter may contain one or more blocking variables.</li>
</ul>
<p><strong>Sample data set</strong>:</p>
<ul>
<li>ID variable (<code>id</code>)</li>
<li>The explanatory variable when using regression and rate models, but
can be missing (<code>x</code>)</li>
<li>The statistic variable(s) we are interested in estimating
(<code>y</code>)</li>
</ul>
<p><strong>Example data</strong></p>
<p>There are two synthetic data sets in the <code>struktuR</code>
package that contain lonely strata: pop_data_1obs, sample_data_1obs.
<code>pop_data_1obs</code> represents a population data set with 10005
rows, each one representing a company. We will use the variable
<code>employees</code>, which refers to the number of employees in the
company, or <code>turnover</code>, as the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>-variable.
Variables <code>size</code> and <code>industry</code> will be used to
specify the values of the <code>strata</code>, <code>block</code>,
and/or <code>group</code> parameters of the function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pop_data_1obs</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
employees
</th>
<th style="text-align:right;">
employees_f
</th>
<th style="text-align:right;">
employees_m
</th>
<th style="text-align:right;">
turnover
</th>
<th style="text-align:left;">
size
</th>
<th style="text-align:left;">
industry
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
15396.54
</td>
<td style="text-align:left;">
small
</td>
<td style="text-align:left;">
B
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
78814.71
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
B
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
55
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
97128.26
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
B
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
60414.60
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
B
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
237306.65
</td>
<td style="text-align:left;">
big
</td>
<td style="text-align:left;">
B
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
172
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
122
</td>
<td style="text-align:right;">
473721.22
</td>
<td style="text-align:left;">
big
</td>
<td style="text-align:left;">
B
</td>
</tr>
</tbody>
</table>
<p>The data set <code>sample_data_1obs</code> contains 1001 rows
representing a sample of companies. In addition to the variables in the
population data set, we do have some variables among which
<code>job_vacancies</code> will be used as the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>-variable,
representing the number of job positions advertised for the year.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sample_data_1obs</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees_f
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees_m
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
turnover
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
size
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
industry
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
job_vacancies
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sick_days
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sick_days_f
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
sick_days_m
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
132
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
237306.653
</td>
<td style="text-align:left;">
big
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
515
</td>
<td style="text-align:right;">
278
</td>
<td style="text-align:right;">
237
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
63848.919
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
134
</td>
<td style="text-align:right;">
127
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11462.578
</td>
<td style="text-align:left;">
small
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
155
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
170
</td>
<td style="text-align:right;">
7934.057
</td>
<td style="text-align:left;">
big
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
632
</td>
<td style="text-align:right;">
540
</td>
<td style="text-align:right;">
92
</td>
</tr>
<tr>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
167
</td>
<td style="text-align:right;">
81
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
408964.032
</td>
<td style="text-align:left;">
big
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
337
</td>
<td style="text-align:right;">
200
</td>
<td style="text-align:right;">
137
</td>
</tr>
<tr>
<td style="text-align:right;">
55
</td>
<td style="text-align:right;">
124
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
118718.363
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
525
</td>
<td style="text-align:right;">
151
</td>
<td style="text-align:right;">
374
</td>
</tr>
</tbody>
</table>
</div>
<p>Let’s see which strata are lonely strata by running the following
code.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sample_data_1obs</span><span class="op">$</span><span class="va">industry</span><span class="op">)</span></span></code></pre></div>
As it can be noticed, the industry group G has only one observation in
the sample data set.
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Var1
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Freq
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
195
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
197
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
193
</td>
</tr>
<tr>
<td style="text-align:left;">
E
</td>
<td style="text-align:right;">
219
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:right;">
196
</td>
</tr>
<tr>
<td style="text-align:left;">
G
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<p>The same stratum has five observations in the population data set.
Hence, it is, in fact, a lonely stratum that we can handle by using the
<code>merge_lonely_strata</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_data_1obs</span><span class="op">[</span><span class="va">pop_data_1obs</span><span class="op">$</span><span class="va">industry</span><span class="op">==</span><span class="st">"G"</span>, <span class="op">]</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees_f
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees_m
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
turnover
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
size
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
industry
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
10001
</td>
<td style="text-align:right;">
10001
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
10000
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
G
</td>
</tr>
<tr>
<td style="text-align:left;">
10002
</td>
<td style="text-align:right;">
10002
</td>
<td style="text-align:right;">
79
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
15000
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
G
</td>
</tr>
<tr>
<td style="text-align:left;">
10003
</td>
<td style="text-align:right;">
10003
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
9000
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
G
</td>
</tr>
<tr>
<td style="text-align:left;">
10004
</td>
<td style="text-align:right;">
10004
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
13000
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
G
</td>
</tr>
<tr>
<td style="text-align:left;">
10005
</td>
<td style="text-align:right;">
10005
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
12000
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
G
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="parameter-specifications">Parameter specifications<a class="anchor" aria-label="anchor" href="#parameter-specifications"></a>
</h3>
<p>The default values of the parameters <code>block</code> and
<code>group</code> are set to <code>NULL</code>. However, it is highly
recommended to provide these variables. When specifying blocking
variable(s), one must pay attention to that design strata are the most
detailed groups within each block. In other words, each block must be
either a design stratum or a group of design strata. Otherwise, the
function would provide an error message. It is also recommended that
blocks are set in a way that the sampling fractions do not vary a lot
within each block. If possible, one may consider grouping design strata
with similar sampling fractions to reduce bias that may arise merging
strata with different fractions. Bias may occur due to assuming equal
weights for all units within each estimation stratum.</p>
<p>Specification of the the publication domains (<code>group</code>) is
also important to check the suitability of domain variables given
(estimation) strata. Because, one may have issues in the estimation
process with <code>struktur_model</code> later on if one or more domain
variables cut across strata or estimation strata.</p>
<p>An additional parameter <code>exclude</code> in the function, allows
one to include a list of IDs to exclude from the modelling in the
estimation stage. This can be useful if there are some extreme values
which will heavily influence the results but are most likely correct
values. If a singleton stratum includes an ID that is specified to be
excluded, then that stratum is not considered as lonely stratum since
its corresponding variance is set to zero in the estimation with the
<code>struktuR</code> package and the Pyhton version of it.</p>
</div>
<div class="section level3">
<h3 id="usage-of-the-function">Usage of the function<a class="anchor" aria-label="anchor" href="#usage-of-the-function"></a>
</h3>
<p>At first, we will demonstrate how the function
<code>merge_lonely_strata</code> works. Population and sample datasets,
one auxiliary variable
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>-variable),
one statistic variable
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>-variable),
an id variable and strata variable(s) must all be provided. Then, some
examples regarding the effect of blocking variable(s) will be given.
Finally, we will some examples regarding the use of publication domain
variables. Note that blocking and group variables are optional but it
would be good to specify them for the reasons explained above.</p>
<p><strong>Example 1</strong></p>
<p>In this example, we shall use industry groups as the stratification
variable and the number of employees as the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>-variable.
Here, we will not specify any blocking constraint, neither group
variable(s).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_lonely_strata.html">merge_lonely_strata</a></span><span class="op">(</span><span class="va">pop_data_1obs</span>, <span class="va">sample_data_1obs</span>, </span>
<span>                          x <span class="op">=</span> <span class="st">"employees"</span>, </span>
<span>                          y <span class="op">=</span> <span class="st">"job_vacancies"</span>, </span>
<span>                          id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                          strata <span class="op">=</span> <span class="st">"industry"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># </span></span>
<span><span class="co"># # All lonely strata (1) successfully collapsed!</span></span>
<span><span class="co"># Warning in merge_lonely_strata(pop_data_1obs, sample_data_1obs, x =</span></span>
<span><span class="co"># "employees", : Consider providing non-NULL groups to check the suitability of</span></span>
<span><span class="co"># group variables given estimation strata.</span></span></code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
industry
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees_f
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees_m
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
turnover
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
size
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
est_strata
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
merged
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
15396.54
</td>
<td style="text-align:left;">
small
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
78814.71
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
55
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
97128.26
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
60414.60
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
237306.65
</td>
<td style="text-align:left;">
big
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
172
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
122
</td>
<td style="text-align:right;">
473721.22
</td>
<td style="text-align:left;">
big
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
<p>The output of the function is a population dataset with additional
columns:</p>
<ul>
<li>
<code>est_strata</code> refers to the estimation strata which can be
design strata or superstrata that are formed newly.</li>
<li>
<code>merged</code> is an indicator variable taking value 1 if merge
took place or value 0 otherwise.</li>
</ul>
<p>Value of each newly created superstratum is formed by binding values
of the two strata that are merged with underscore as shown in the result
table below. In this example, the lonely stratum “G” is merged to
stratum “D”, so the new estimation strata has a value of “D_G”.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">merged</span><span class="op">==</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># </span></span>
<span><span class="co"># # All lonely strata (1) successfully collapsed!</span></span>
<span><span class="co"># Warning in merge_lonely_strata(pop_data_1obs, sample_data_1obs, x =</span></span>
<span><span class="co"># "employees", : Consider providing non-NULL groups to check the suitability of</span></span>
<span><span class="co"># group variables given estimation strata.</span></span></code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
industry
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees_f
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees_m
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
turnover
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
size
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
est_strata
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
merged
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
4001
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
4543
</td>
<td style="text-align:right;">
129
</td>
<td style="text-align:right;">
108
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
93900.10
</td>
<td style="text-align:left;">
big
</td>
<td style="text-align:left;">
D_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
4002
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
4535
</td>
<td style="text-align:right;">
82
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
65
</td>
<td style="text-align:right;">
107087.07
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
D_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
4003
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
4536
</td>
<td style="text-align:right;">
240
</td>
<td style="text-align:right;">
144
</td>
<td style="text-align:right;">
96
</td>
<td style="text-align:right;">
357626.36
</td>
<td style="text-align:left;">
big
</td>
<td style="text-align:left;">
D_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
4004
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
4537
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
62149.90
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
D_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
4005
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
4538
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
22390.25
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
D_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
4006
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
4539
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
20276.47
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
D_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Example 2</strong></p>
<p>In the examples below, we shall use both size and industry groups as
the stratification variables and turnover as the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>-variable.
In this example, We will examine strata merge without blocking
variable(s).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_lonely_strata.html">merge_lonely_strata</a></span><span class="op">(</span><span class="va">pop_data_1obs</span>, <span class="va">sample_data_1obs</span>, </span>
<span>                          x <span class="op">=</span> <span class="st">"turnover"</span>, </span>
<span>                          y <span class="op">=</span> <span class="st">"job_vacancies"</span>, </span>
<span>                          id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                          strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"size"</span>, <span class="st">"industry"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>As it can seen from the Table in the previous section, the company in
the lonely stratum “G” is a medium-size company, so its size group is
“mid”. With strata merge, stratum “mid_G” is merged to stratum
“small_D”. When we do not specify a blocking variable, it is possible to
have such merging. If sampling fractions differ quite much among small-
and medium size groups, then this may bring about a bias problem as
mentioned previously. To reduce bias, one may put a blocking constraint
when forming superstrata. This is demonstrated below.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">merged</span><span class="op">==</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># </span></span>
<span><span class="co"># # All lonely strata (1) successfully collapsed!</span></span>
<span><span class="co"># Warning in merge_lonely_strata(pop_data_1obs, sample_data_1obs, x = "turnover",</span></span>
<span><span class="co"># : Consider providing non-NULL groups to check the suitability of group</span></span>
<span><span class="co"># variables given estimation strata.</span></span></code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees_f
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees_m
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
turnover
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
size
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
industry
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
est_strata
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
merged
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
9176
</td>
<td style="text-align:right;">
10001
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
10000.0000
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
G
</td>
<td style="text-align:left;">
small_D_mid_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
9177
</td>
<td style="text-align:right;">
10002
</td>
<td style="text-align:right;">
79
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
15000.0000
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
G
</td>
<td style="text-align:left;">
small_D_mid_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
9178
</td>
<td style="text-align:right;">
10003
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
9000.0000
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
G
</td>
<td style="text-align:left;">
small_D_mid_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
9179
</td>
<td style="text-align:right;">
10004
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
13000.0000
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
G
</td>
<td style="text-align:left;">
small_D_mid_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
9180
</td>
<td style="text-align:right;">
10005
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
12000.0000
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
G
</td>
<td style="text-align:left;">
small_D_mid_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
9499
</td>
<td style="text-align:right;">
4906
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
301.7372
</td>
<td style="text-align:left;">
small
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:left;">
small_D_mid_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Example 3</strong></p>
<p>In this example, we shall put a blocking constraint as such that
strata merge will only take place within blocks, which means that strata
from different blocks cannot be merged even they are similar to each
other in terms of the population mean of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>-variable
(turnover here).</p>
<p>To avoid merging strata from different size groups, we may use size
groups as the value of the <code>block</code> parameter as follows:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_lonely_strata.html">merge_lonely_strata</a></span><span class="op">(</span><span class="va">pop_data_1obs</span>, <span class="va">sample_data_1obs</span>, </span>
<span>                          x <span class="op">=</span> <span class="st">"turnover"</span>, </span>
<span>                          y <span class="op">=</span> <span class="st">"job_vacancies"</span>, </span>
<span>                          id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                          strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"size"</span>, <span class="st">"industry"</span><span class="op">)</span>,</span>
<span>                          block <span class="op">=</span> <span class="st">"size"</span><span class="op">)</span></span></code></pre></div>
<p>Since we avoid strata merge across blocks, the lonely stratum “mid_G”
is now merged to stratum “mid_C” instead of “small_D”. The new super
strata is called “mid_C_mid_G” as seen below.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">merged</span><span class="op">==</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># </span></span>
<span><span class="co"># # All lonely strata (1) successfully collapsed!</span></span>
<span><span class="co"># Warning in merge_lonely_strata(pop_data_1obs, sample_data_1obs, x = "turnover",</span></span>
<span><span class="co"># : Consider providing non-NULL groups to check the suitability of group</span></span>
<span><span class="co"># variables given estimation strata.</span></span></code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees_f
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
employees_m
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
turnover
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
size
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
industry
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
est_strata
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
merged
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
4425
</td>
<td style="text-align:right;">
3465
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
74122.764
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
mid_C_mid_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
4426
</td>
<td style="text-align:right;">
3862
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
114993.527
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
mid_C_mid_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
4427
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
5720.938
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
mid_C_mid_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
4428
</td>
<td style="text-align:right;">
3903
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
92782.059
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
mid_C_mid_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
4429
</td>
<td style="text-align:right;">
3942
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
17956.721
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
mid_C_mid_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
4430
</td>
<td style="text-align:right;">
2042
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
26477.678
</td>
<td style="text-align:left;">
mid
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
mid_C_mid_G
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Example 4</strong></p>
<p>In this example, we demonstrate how to specify the grouping variable.
At first, we will use an inappropriate group variable, and then we will
fix this by creating a suitable one depending on which design strata are
merged.</p>
<p>Suppose that we wish to produce statistics at country level and by
industry groups. If so, we need put a variable corresponding to country
and industry groups as the value of the <code>group</code>
parameter.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_data_1obs</span><span class="op">$</span><span class="va">country</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_lonely_strata.html">merge_lonely_strata</a></span><span class="op">(</span><span class="va">pop_data_1obs</span>, <span class="va">sample_data_1obs</span>, </span>
<span>                          x <span class="op">=</span> <span class="st">"turnover"</span>, </span>
<span>                          y <span class="op">=</span> <span class="st">"job_vacancies"</span>, </span>
<span>                          id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                          strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"size"</span>, <span class="st">"industry"</span><span class="op">)</span>,</span>
<span>                          block <span class="op">=</span> <span class="st">"size"</span>,</span>
<span>                          group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"industry"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The code above will produce a warning message since one or more group
variables(s) cut across strata or super strata (estimation strata). This
is due to the fact that two industry groups, that is, “C” and “G” are
merged, and so the publication domain needs to be minimum at estimation
strata level. In other words, design strata or super strata need to be
the most detailed groups within each publication domain.</p>
<pre><code><span><span class="co"># There were 10 observations that were missing values for job_vacancies. These were removed from the sample data</span></span>
<span><span class="co"># The following strata, being neither surprise nor full count, had only 1 observation in the sample:  mid_G . Strata merge was attempted.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # All lonely strata (1) successfully collapsed!</span></span>
<span><span class="co"># Warning in merge_lonely_strata(pop_data_1obs, sample_data_1obs, x = "turnover",</span></span>
<span><span class="co"># : One or more group variables cut across estimation strata. Set group variables</span></span>
<span><span class="co"># in a way that estimation strata are the most detailed levels within each group.</span></span>
<span><span class="co"># The variable est_strata should be used for the variable job_vacancies in the next steps of the estimation functions as the value of the strata parameter.</span></span></code></pre>
<p>The function would still produce an output data. However, this will
be an issue when newly created estimation strata are used as the
stratification variable with an inappropriate publication domain
variable in the <code>struktuR</code> R package. One can use the output
of the function <code>merge_lonely_strata</code> as a diagnostic to
decide suitable publication domains given strata or estimation
strata.</p>
<p>To remedy the issue in this example, we will simply create a new
domain variable by merging two design strata as follows.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_data_1obs</span><span class="op">$</span><span class="va">domain</span> <span class="op">&lt;-</span> <span class="va">pop_data_1obs</span><span class="op">$</span><span class="va">industry</span></span>
<span><span class="va">pop_data_1obs</span><span class="op">$</span><span class="va">domain</span><span class="op">[</span><span class="va">pop_data_1obs</span><span class="op">$</span><span class="va">industry</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"G"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"C_G"</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_lonely_strata.html">merge_lonely_strata</a></span><span class="op">(</span><span class="va">pop_data_1obs</span>, <span class="va">sample_data_1obs</span>, </span>
<span>                          x <span class="op">=</span> <span class="st">"turnover"</span>, </span>
<span>                          y <span class="op">=</span> <span class="st">"job_vacancies"</span>, </span>
<span>                          id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                          strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"size"</span>, <span class="st">"industry"</span><span class="op">)</span>,</span>
<span>                          block <span class="op">=</span> <span class="st">"size"</span>,</span>
<span>                          group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"domain"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="restrictions">Restrictions<a class="anchor" aria-label="anchor" href="#restrictions"></a>
</h3>
<ul>
<li><p>The use of this function will require some expert judgement when
it comes to the specification of the <code>block</code> and
<code>group</code> parameters. There may be some back and forwards.
Users are advised to modify their choices depending on whether strata
merge was successful and if so, which strata were merged.</p></li>
<li><p>This function can only be used for a single statistic variable
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>-variable).
As a result of this, one may obtain different strata merge for different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>-variables,
and so publication domains per variable may differ as well. This is
because of the fact that the identification of lonely strata is done
based on the number of observations within strata with non-null
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>-values.
If missing patterns by strata vary a lot from variable to variable, then
a lonely stratum for one
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>-variable
may not be a lonely stratum for another statistic variable.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Susie Jentoft, Øyvind Langsrud, Anna-Karin Mevik, Melike Oguz Alper.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
